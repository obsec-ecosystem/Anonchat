/* ================= Core ================= */

const ICONS = {
    HASH: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 9h16M4 15h16M10 3L8 21M16 3l-2 18"/></svg>`,
    USER: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
    LOCK: `<svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="4" y="11" width="16" height="9" rx="2"/><path d="M8 11V7a4 4 0 018 0v4"/></svg>`
};

const EMOJI_PICKER = ['üòÄ', 'üòÑ', 'üòÇ', 'üòä', 'üòç', 'üòé', 'üëç', 'üî•', '‚ú®', 'üéâ'];
const MAX_UPLOAD_BYTES = 10 * 1024 * 1024;
const MAX_UPLOAD_LABEL = '10 MB';

const state = {
    room: 'all',
    lastId: 0,
    fetching: false,
    autoScroll: true,
    unread: 0,
    navQuery: '',
    filterQuery: '',
    peers: [],
    lastGroupKey: null,
    rooms: [],
    currentInterface: '',
    interfaces: [],
    pendingOut: [],
    unreadByRoom: {},
    sidebarLastId: 0,
    notifications: [],
    blockedPeers: new Set(),
    meId: '',
    mutedRooms: new Set(),
    memberPopover: null
};

const els = {
    feed: document.getElementById('feed'),
    rooms: document.getElementById('rooms-list'),
    peers: document.getElementById('peers-list'),
    title: document.getElementById('current-room-name'),
    count: document.getElementById('peer-count'),
    statusDot: document.getElementById('status-indicator'),
    statusText: document.getElementById('connection-status'),
    statusLabel: document.getElementById('status-label'),
    userName: document.getElementById('user-name'),
    nicknameInput: document.getElementById('nickname-input'),
    nicknameSave: document.getElementById('nickname-save'),
    form: document.getElementById('send-form'),
    msg: document.getElementById('message'),
    ifaceMenu: document.getElementById('interface-menu'),
    navFilter: document.getElementById('nav-filter'),
    sidebarSettings: document.getElementById('sidebar-settings'),
    createRoom: document.getElementById('create-room'),
    membersSection: document.getElementById('members-section'),
    membersList: document.getElementById('members-list'),
    membersCount: document.getElementById('members-count'),
    messageFilter: document.getElementById('message-filter'),
    autoScrollBtn: document.getElementById('auto-scroll'),
    muteRoomBtn: document.getElementById('mute-room'),
    markReadBtn: document.getElementById('mark-read'),
    clearBtn: document.getElementById('clear-feed'),
    roomChip: document.getElementById('room-chip'),
    scrollBtn: document.getElementById('scroll-to-bottom'),
    unreadBadge: document.getElementById('unread-count'),
    emptyState: document.getElementById('empty-state'),
    toast: document.getElementById('toast'),
    charCount: document.getElementById('char-count'),
    fileInput: document.getElementById('file-input'),
    attachButton: document.getElementById('attach-button'),
    emojiToggle: document.getElementById('emoji-toggle'),
    emojiPicker: document.getElementById('emoji-picker'),
    homeSummary: document.getElementById('home-summary'),
    homePeers: document.getElementById('home-peers'),
    homePeerCount: document.getElementById('home-peer-count'),
    homeNearby: document.getElementById('home-nearby'),
    homeInterface: document.getElementById('home-interface'),
    homeUnread: document.getElementById('home-unread'),
    homeNotifications: document.getElementById('home-notifications'),
    homeRoomCount: document.getElementById('home-room-count'),
    toolbar: document.querySelector('.toolbar'),
    composer: document.querySelector('.composer'),
    roomModal: document.getElementById('room-modal'),
    roomModalTitle: document.getElementById('room-modal-title'),
    roomModalClose: document.getElementById('room-modal-close'),
    roomModalCancel: document.getElementById('room-modal-cancel'),
    roomModalSubmit: document.getElementById('room-modal-submit'),
    roomCreateName: document.getElementById('room-create-name'),
    roomCreatePassword: document.getElementById('room-create-password'),
    roomCreateLimit: document.getElementById('room-create-limit'),
    roomCreateDiscoverable: document.getElementById('room-create-discoverable'),
    roomJoinName: document.getElementById('room-join-name'),
    roomJoinPassword: document.getElementById('room-join-password'),
    roomJoinMeta: document.getElementById('room-join-meta'),
    memberPopover: document.getElementById('member-popover'),
    memberPopoverName: document.getElementById('member-popover-name'),
    memberPopoverId: document.getElementById('member-popover-id'),
    memberPopoverMessage: document.getElementById('member-popover-message'),
    memberPopoverKick: document.getElementById('member-popover-kick')
};
